--------------------------------------------------------------------------------------------------
      name:  Grant Aarons Assignment 3
       log:  C:\Users\gaarons\Git\Notes\Stata\2016F\Metrics\logs\stata_3.log
  log type:  text
 opened on:  11 Jan 2017, 20:52:09

. * Use s or t to get smcl or text log file
. /*
> Grant Aarons
> gaarons@london.edu
> Econometrics 1, London Business School
> */
. global programdir C:\Users\gaarons\Git\Notes\Stata\2016F\Metrics\programs

. global datadir C:\Users\gaarons\Git\Notes\Stata\2016F\Metrics\data

. global outputdir C:\Users\gaarons\Git\Notes\Stata\2016F\Metrics\output

. /*
> Program: stata_31.do
> Description: Introduction to econometrics in stata
> */
. 
. do $programdir/stata_31.do

. /*
> Grant Aarons
> gaarons@london.edu
> Econometrics 1, London Business School
> Assignment 3
> */
. * Load the data
. import excel "$datadir/schaller.xls", sheet("Sheet1") firstrow clear

. *pause Dataset has been loaded
. 
. 
. *** Part A
. * Tabulate the variables we were given as standard practice
. tabstat inv q, stat(min max mean sd)

   stats |       inv         q
---------+--------------------
     min |         0 -1.966133
     max |  .7142991  45.44712
    mean |  .1686158  1.601154
      sd |  .0899994  3.803969
------------------------------

. tabstat inv q, by(year) stat(min max mean sd)

Summary statistics: min, max, mean, sd
  by categories of: year (year)

    year |       inv         q
---------+--------------------
       1 |  .0205936 -1.748583
         |  .6704475  6.588722
         |  .1927996  .5728584
         |   .112118  1.648371
---------+--------------------
       2 |  .0107318 -1.405087
         |  .5325488  6.588691
         |  .1718815   .597845
         |  .0927825  1.577901
---------+--------------------
       3 |  .0113419 -1.508873
         |  .4278665  6.862064
         |  .1607248  .6349403
         |  .0906696  1.647415
---------+--------------------
       4 |   .020651 -1.917622
         |  .5146071   9.03307
         |  .1472462  .4967591
         |  .0863553   1.78078
---------+--------------------
       5 |  .0169944 -1.636174
         |  .4385091  16.39879
         |  .1687614  1.575704
         |  .0985533  2.936246
---------+--------------------
       6 |  .0140286 -1.316996
         |  .5664171  19.55134
         |  .2085197  2.143651
         |  .1088841  3.536015
---------+--------------------
       7 |  .0214348 -1.514729
         |  .5919886    15.757
         |  .1891974  1.982852
         |   .097126  3.214572
---------+--------------------
       8 |  .0210933 -1.966133
         |  .5523365  14.29717
         |  .1445815  1.188414
         |  .0933408  2.806896
---------+--------------------
       9 |  .0088241 -1.738319
         |  .6472303  25.06137
         |  .1469142  2.615832
         |  .0936516  4.240391
---------+--------------------
      10 |   .011097 -1.219954
         |  .6800648  41.90479
         |  .1684816  3.291839
         |   .104496  5.477325
---------+--------------------
      11 |         0 -1.477367
         |  .7142991  30.18523
         |  .1494652  2.990903
         |  .0990541  5.405804
---------+--------------------
      12 |  .0182395 -1.211948
         |  .5982081  45.44712
         |  .1608216  3.946245
         |  .0958416  6.795034
---------+--------------------
      13 |  .0338612 -1.499547
         |  .5844074   36.9486
         |   .170258  2.496707
         |   .092345  4.696228
---------+--------------------
      14 |  .0159083 -1.326542
         |  .6414233   33.9775
         |  .1872097  2.878355
         |  .0944825  5.152764
---------+--------------------
      15 |  .0456929 -1.344155
         |  .5690441   30.4778
         |  .2180801  2.873494
         |  .0922757   4.62583
---------+--------------------
      16 |  .0360537 -.8103173
         |   .655834  34.83765
         |  .2338404  3.488654
         |  .1016048   5.38048
---------+--------------------
      17 |  .0221875 -1.069489
         |  .6108891  26.40782
         |  .2184982  2.396935
         |  .1053458  4.369127
---------+--------------------
      18 |  .0287359  -1.00933
         |  .4589968  32.06573
         |  .1938358  3.517091
         |  .0837783  5.388207
---------+--------------------
      19 |  .0264943 -.7960994
         |  .6606368  27.86442
         |  .1970291    3.4057
         |  .0883814  4.786166
---------+--------------------
      20 |  .0167316 -1.255464
         |  .4899229  28.40281
         |  .1765477   2.31209
         |   .073611  4.739304
---------+--------------------
      21 |   .005226 -1.066554
         |  .4338658  19.17337
         |  .1469716  1.841841
         |  .0706017  3.489996
---------+--------------------
      22 |  .0145928 -1.131676
         |  .4037121  23.90062
         |  .1444561  2.179387
         |  .0679987  4.141808
---------+--------------------
      23 |  .0329763 -1.542628
         |  .4842557  27.49858
         |   .179273  2.346174
         |  .0853335  4.718412
---------+--------------------
      24 |   .027034 -1.610933
         |  .4426112  20.43754
         |  .1931256  1.318847
         |  .0856918  3.528182
---------+--------------------
      25 |  .0077582 -1.955251
         |  .4441033  13.70439
         |   .151674  .2314248
         |  .0673722  1.925192
---------+--------------------
      26 |  .0190473 -1.428982
         |  .3261356  11.73812
         |  .1382109  .4759651
         |  .0570254   1.95111
---------+--------------------
      27 |  .0209634 -1.275176
         |  .3595692  10.10888
         |  .1506596   .618547
         |  .0608719  1.754108
---------+--------------------
      28 |  .0438521 -1.347831
         |  .4033135  7.400327
         |  .1579665  .2473247
         |  .0649604  1.413838
---------+--------------------
      29 |  .0144415 -1.547875
         |  .6127569  9.157542
         |  .1717787  .1102235
         |  .0799605  1.391528
---------+--------------------
      30 |  .0184241 -1.279086
         |   .361407  9.488826
         |  .1628513  .1234602
         |  .0678179  1.305088
---------+--------------------
      31 |  .0212685 -1.405766
         |   .361128  10.21523
         |  .1569981  .2477085
         |  .0689526  1.521988
---------+--------------------
      32 |  .0150045 -1.365615
         |  .4270046  6.407879
         |  .1365325  .0176893
         |   .065645  1.335595
---------+--------------------
      33 |  .0092279 -1.760928
         |  .6422654  8.459704
         |  .1219511  .1681494
         |  .0767863  1.469953
---------+--------------------
      34 |  .0138137 -1.722591
         |  .5336629  7.986071
         |  .1385301  .4142811
         |  .0793025  1.433183
---------+--------------------
      35 |   .012056 -1.870826
         |  .4314426  6.277641
         |  .1458804   .292498
         |  .0779655  1.263107
---------+--------------------
   Total |         0 -1.966133
         |  .7142991  45.44712
         |  .1686158  1.601154
         |  .0899994  3.803969
------------------------------

. * Too long a printout by firm, but could be used
. *tabstat inv q, by(firm) stat(min max mean sd)
. 
. * Run the required regression of inv = alpha + beta_1*q
. reg inv q

      Source |       SS           df       MS      Number of obs   =     5,740
-------------+----------------------------------   F(1, 5738)      =    791.81
       Model |  5.63683287         1  5.63683287   Prob > F        =    0.0000
    Residual |  40.8484783     5,738   .00711894   R-squared       =    0.1213
-------------+----------------------------------   Adj R-squared   =    0.1211
       Total |  46.4853111     5,739  .008099897   Root MSE        =    .08437

------------------------------------------------------------------------------
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           q |   .0082388   .0002928    28.14   0.000     .0076648    .0088127
       _cons |   .1554243   .0012083   128.63   0.000     .1530555     .157793
------------------------------------------------------------------------------

. 
. *pause Part A completed
. 
. 
. *** Part B
. * Create dummy variables corresponding to each firm using ``xi'' command
. xi firm

. reg inv q i.firm

      Source |       SS           df       MS      Number of obs   =     5,740
-------------+----------------------------------   F(164, 5575)    =     21.55
       Model |  18.0371613       164  .109982691   Prob > F        =    0.0000
    Residual |  28.4481498     5,575  .005102807   R-squared       =    0.3880
-------------+----------------------------------   Adj R-squared   =    0.3700
       Total |  46.4853111     5,739  .008099897   Root MSE        =    .07143

------------------------------------------------------------------------------
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           q |    .007249   .0003543    20.46   0.000     .0065544    .0079437
             |
        firm |
          2  |  -.0110881   .0171628    -0.65   0.518    -.0447339    .0225577
          3  |   .1144593   .0171091     6.69   0.000     .0809188    .1479999
          4  |  -.0299033   .0171512    -1.74   0.081    -.0635263    .0037196
          5  |  -.0131718    .017159    -0.77   0.443    -.0468102    .0204666
          6  |   .0295458   .0171438     1.72   0.085    -.0040628    .0631544
          7  |  -.0179783   .0171701    -1.05   0.295    -.0516385    .0156819
          8  |  -.0288828    .017146    -1.68   0.092    -.0624955    .0047299
          9  |  -.0102863   .0171597    -0.60   0.549     -.043926    .0233535
         10  |   .0012063   .0171321     0.07   0.944    -.0323793    .0347918
         11  |  -.0333366    .017152    -1.94   0.052    -.0669612    .0002879
         12  |   .0018204   .0171088     0.11   0.915    -.0317196    .0353604
         13  |  -.0626703   .0172465    -3.63   0.000    -.0964802   -.0288605
         14  |   .0299757    .017154     1.75   0.081    -.0036528    .0636042
         15  |   .0299541   .0171049     1.75   0.080    -.0035781    .0634864
         16  |  -.0105629    .017164    -0.62   0.538    -.0442109    .0230852
         17  |   .0073799   .0171342     0.43   0.667    -.0262099    .0409697
         18  |  -.0479316   .0171712    -2.79   0.005    -.0815939   -.0142694
         19  |   .0637984   .0171457     3.72   0.000     .0301863    .0974106
         20  |    .037534   .0171446     2.19   0.029      .003924     .071144
         21  |   .0033487   .0171188     0.20   0.845    -.0302108    .0369082
         22  |   .0302641    .017113     1.77   0.077    -.0032841    .0638123
         23  |  -.0303263   .0171771    -1.77   0.078        -.064    .0033474
         24  |   .0416049   .0170807     2.44   0.015       .00812    .0750897
         25  |   .0983835   .0171279     5.74   0.000     .0648062    .1319608
         26  |  -.0093883   .0171363    -0.55   0.584    -.0429821    .0242056
         27  |   .0475203   .0171412     2.77   0.006     .0139168    .0811237
         28  |  -.0567045   .0170798    -3.32   0.001    -.0901876   -.0232214
         29  |  -.0106659   .0171139    -0.62   0.533    -.0442157     .022884
         30  |   .0435252   .0171216     2.54   0.011     .0099602    .0770903
         31  |   .0755715   .0171089     4.42   0.000     .0420314    .1091115
         32  |   .0205752   .0171604     1.20   0.231    -.0130659    .0542164
         33  |   .0620965    .017091     3.63   0.000     .0285915    .0956015
         34  |   .0030676   .0171605     0.18   0.858    -.0305736    .0367088
         35  |   .0632206   .0171094     3.70   0.000     .0296795    .0967617
         36  |   .0552266   .0171313     3.22   0.001     .0216426    .0888107
         37  |  -.0210293   .0171333    -1.23   0.220    -.0546173    .0125587
         38  |   .0675202   .0171455     3.94   0.000     .0339083    .1011321
         39  |   .0023553   .0171479     0.14   0.891    -.0312612    .0359719
         40  |   .0053389   .0171174     0.31   0.755     -.028218    .0388957
         41  |  -.0111797   .0170966    -0.65   0.513    -.0446957    .0223363
         42  |    .003941   .0171214     0.23   0.818    -.0296235    .0375056
         43  |    .009515   .0171506     0.55   0.579    -.0241068    .0431369
         44  |   .0487956   .0171345     2.85   0.004     .0152054    .0823859
         45  |   .0431771   .0171268     2.52   0.012      .009602    .0767523
         46  |   .0745948   .0171477     4.35   0.000     .0409785    .1082111
         47  |  -.0113431   .0171585    -0.66   0.509    -.0449804    .0222943
         48  |   .0060311    .017105     0.35   0.724    -.0275013    .0395635
         49  |  -.0075513   .0171799    -0.44   0.660    -.0412306     .026128
         50  |  -.0351712   .0171655    -2.05   0.041    -.0688223     -.00152
         51  |   -.014578   .0171518    -0.85   0.395    -.0482021    .0190461
         52  |  -.0170216   .0171304    -0.99   0.320    -.0506038    .0165606
         53  |  -.0350846   .0171745    -2.04   0.041    -.0687533   -.0014159
         54  |    .021855   .0171225     1.28   0.202    -.0117117    .0554218
         55  |   .0219519   .0171542     1.28   0.201     -.011677    .0555808
         56  |   .0318367   .0171471     1.86   0.063    -.0017783    .0654517
         57  |   .0461108   .0171369     2.69   0.007     .0125157    .0797059
         58  |  -.0164856   .0170781    -0.97   0.334    -.0499654    .0169941
         59  |   .0258278   .0171496     1.51   0.132     -.007792    .0594476
         60  |   .0461384   .0170906     2.70   0.007     .0126342    .0796425
         61  |   .0948239   .0171271     5.54   0.000      .061248    .1283997
         62  |   .0181437   .0170817     1.06   0.288    -.0153432    .0516306
         63  |  -.0138999   .0171558    -0.81   0.418     -.047532    .0197321
         64  |  -.0218311   .0171141    -1.28   0.202    -.0553815    .0117193
         65  |   .0429222   .0171283     2.51   0.012      .009344    .0765003
         66  |   .0747595    .017076     4.38   0.000     .0412839    .1082351
         67  |   .0701564   .0171259     4.10   0.000     .0365831    .1037298
         68  |   .0002675   .0171323     0.02   0.988    -.0333185    .0338534
         69  |   .0460002   .0171216     2.69   0.007     .0124352    .0795652
         70  |   .0683109   .0171055     3.99   0.000     .0347775    .1018444
         71  |   .0279947   .0171355     1.63   0.102    -.0055975     .061587
         72  |   .0685164    .017128     4.00   0.000     .0349388     .102094
         73  |   .0334759    .017076     1.96   0.050     2.71e-07    .0669515
         74  |   .1187479   .0171123     6.94   0.000     .0852011    .1522947
         75  |    .000034   .0171192     0.00   0.998    -.0335264    .0335943
         76  |  -.0218521    .017176    -1.27   0.203    -.0555238    .0118196
         77  |   .0353268   .0171035     2.07   0.039     .0017974    .0688563
         78  |   .0150356   .0170872     0.88   0.379    -.0184619     .048533
         79  |   .0102299   .0171945     0.59   0.552     -.023478    .0439379
         80  |   .0039382   .0171484     0.23   0.818    -.0296793    .0375558
         81  |   .0184951   .0171391     1.08   0.281    -.0151041    .0520943
         82  |  -.0116276     .01716    -0.68   0.498    -.0452678    .0220127
         83  |   .0826889   .0171298     4.83   0.000     .0491079    .1162699
         84  |   .0102795    .017157     0.60   0.549    -.0233549     .043914
         85  |  -.0076072   .0171474    -0.44   0.657    -.0412227    .0260084
         86  |   .0313087   .0170968     1.83   0.067    -.0022077    .0648251
         87  |  -.0275372    .017099    -1.61   0.107    -.0610578    .0059834
         88  |  -.0599936   .0171762    -3.49   0.000    -.0936656   -.0263217
         89  |   .1633283    .017079     9.56   0.000     .1298468    .1968097
         90  |   .0081582   .0171509     0.48   0.634    -.0254643    .0417807
         91  |   -.030904   .0171306    -1.80   0.071    -.0644867    .0026787
         92  |  -.0180802   .0171059    -1.06   0.291    -.0516145    .0154541
         93  |    .061324   .0170765     3.59   0.000     .0278473    .0948006
         94  |   -.000042   .0171425    -0.00   0.998    -.0336479    .0335639
         95  |  -.0093794   .0171398    -0.55   0.584    -.0429802    .0242213
         96  |  -.0172457   .0171775    -1.00   0.315    -.0509202    .0164288
         97  |    .133017   .0171655     7.75   0.000     .0993659     .166668
         98  |  -.0031429   .0171327    -0.18   0.854    -.0367296    .0304438
         99  |   .0409969   .0171073     2.40   0.017     .0074599    .0745338
        100  |   .0317446   .0171282     1.85   0.064    -.0018333    .0653225
        101  |  -.0117057   .0171386    -0.68   0.495    -.0453041    .0218927
        102  |  -.0047098   .0170769    -0.28   0.783    -.0381872    .0287675
        103  |   .0809494   .0171046     4.73   0.000     .0474178    .1144811
        104  |    -.04242   .0171655    -2.47   0.013    -.0760711   -.0087689
        105  |  -.0092774   .0171248    -0.54   0.588    -.0428487    .0242939
        106  |   .0096833   .0171703     0.56   0.573    -.0239773    .0433439
        107  |   .0668296   .0171257     3.90   0.000     .0332566    .1004026
        108  |  -.0319637   .0171538    -1.86   0.062    -.0655919    .0016645
        109  |  -.0208587   .0171625    -1.22   0.224     -.054504    .0127865
        110  |   .0406201   .0171572     2.37   0.018     .0069853    .0742549
        111  |   .0033588   .0171546     0.20   0.845    -.0302708    .0369884
        112  |  -.0346632   .0172433    -2.01   0.044    -.0684668   -.0008596
        113  |   .0231535   .0171585     1.35   0.177    -.0104839     .056791
        114  |   .0125792   .0172291     0.73   0.465    -.0211966    .0463549
        115  |  -.0169208   .0171619    -0.99   0.324    -.0505649    .0167232
        116  |   .0422971   .0171135     2.47   0.013     .0087479    .0758463
        117  |    .118987   .0170846     6.96   0.000     .0854945    .1524796
        118  |  -.0081228    .017153    -0.47   0.636    -.0417494    .0255038
        119  |  -.0221458   .0170959    -1.30   0.195    -.0556604    .0113688
        120  |   .0237715   .0171219     1.39   0.165    -.0097942    .0573371
        121  |  -.0102183   .0171641    -0.60   0.552    -.0438667    .0234301
        122  |  -.0261932    .017147    -1.53   0.127    -.0598079    .0074216
        123  |    .114001   .0171271     6.66   0.000     .0804252    .1475767
        124  |   .0278888   .0171065     1.63   0.103    -.0056467    .0614242
        125  |  -.0029403   .0171321    -0.17   0.864    -.0365259    .0306453
        126  |  -.0069179   .0171391    -0.40   0.686    -.0405172    .0266814
        127  |   .0136327   .0171308     0.80   0.426    -.0199503    .0472158
        128  |   .0681524    .017084     3.99   0.000     .0346612    .1016436
        129  |   .0146445    .017076     0.86   0.391    -.0188312    .0481202
        130  |  -.0654175   .0171515    -3.81   0.000    -.0990411   -.0317938
        131  |   .0228469   .0171368     1.33   0.183    -.0107479    .0564417
        132  |  -.0359411   .0171453    -2.10   0.036    -.0695527   -.0023296
        133  |   .0962414   .0171039     5.63   0.000     .0627111    .1297718
        134  |    .154328   .0171078     9.02   0.000     .1207901    .1878659
        135  |  -.0470046   .0171615    -2.74   0.006    -.0806477   -.0133614
        136  |   .0097354     .01714     0.57   0.570    -.0238656    .0433364
        137  |   -.021706   .0171425    -1.27   0.205     -.055312    .0118999
        138  |   .0481099   .0171488     2.81   0.005     .0144915    .0817282
        139  |   .1480501   .0171195     8.65   0.000     .1144893     .181611
        140  |    .034904   .0170849     2.04   0.041      .001411     .068397
        141  |   .0460388   .0171494     2.68   0.007     .0124193    .0796582
        142  |   .0125785   .0170974     0.74   0.462     -.020939     .046096
        143  |  -.0526768   .0174231    -3.02   0.003    -.0868328   -.0185207
        144  |   .0085849   .0170765     0.50   0.615    -.0248917    .0420615
        145  |    .026235    .017142     1.53   0.126    -.0073701    .0598401
        146  |   .0101592   .0171455     0.59   0.554    -.0234527    .0437711
        147  |  -.0571875   .0170837    -3.35   0.001    -.0906781   -.0236968
        148  |  -.0134221   .0171724    -0.78   0.434    -.0470867    .0202426
        149  |   -.031901   .0171313    -1.86   0.063    -.0654849    .0016829
        150  |   .0948328   .0171226     5.54   0.000     .0612658    .1283997
        151  |   .0718996   .0171187     4.20   0.000     .0383402     .105459
        152  |   .0511302   .0170784     2.99   0.003     .0176498    .0846106
        153  |   .0137322   .0171189     0.80   0.422    -.0198274    .0472919
        154  |   .0102959   .0171328     0.60   0.548     -.023291    .0438828
        155  |   .0079635   .0171219     0.47   0.642    -.0256021    .0415292
        156  |  -.0071696   .0171092    -0.42   0.675    -.0407102     .026371
        157  |  -.0306744   .0171116    -1.79   0.073    -.0642197    .0028709
        158  |  -.0000973   .0171537    -0.01   0.995    -.0337252    .0335306
        159  |   .0100507   .0171292     0.59   0.557    -.0235291    .0436306
        160  |   -.003881   .0171547    -0.23   0.821    -.0375109    .0297488
        161  |  -.0054513   .0170979    -0.32   0.750    -.0389697    .0280672
        162  |  -.0424006   .0171917    -2.47   0.014     -.076103   -.0086983
        163  |  -.0316199   .0170922    -1.85   0.064    -.0651272    .0018874
        164  |   .2038804   .0172066    11.85   0.000     .1701489     .237612
             |
       _cons |   .1394105   .0121809    11.45   0.000     .1155313    .1632898
------------------------------------------------------------------------------

. 
. *pause Part B completed
. 
. *** Part C
. * regress inv on firm dummies alone and obtain the residual
. reg inv i.firm

      Source |       SS           df       MS      Number of obs   =     5,740
-------------+----------------------------------   F(163, 5576)    =     17.79
       Model |  15.9015861       163  .097555743   Prob > F        =    0.0000
    Residual |   30.583725     5,576  .005484886   R-squared       =    0.3421
-------------+----------------------------------   Adj R-squared   =    0.3228
       Total |  46.4853111     5,739  .008099897   Root MSE        =    .07406

------------------------------------------------------------------------------
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        firm |
          2  |  -.0463644   .0177037    -2.62   0.009    -.0810706   -.0116582
          3  |   .0926863   .0177037     5.24   0.000     .0579801    .1273925
          4  |  -.0627225   .0177037    -3.54   0.000    -.0974287   -.0280163
          5  |  -.0476682   .0177037    -2.69   0.007    -.0823744    -.012962
          6  |  -.0016269   .0177037    -0.09   0.927    -.0363331    .0330794
          7  |  -.0547145   .0177037    -3.09   0.002    -.0894207   -.0200083
          8  |  -.0605399   .0177037    -3.42   0.001    -.0952461   -.0258337
          9  |  -.0449276   .0177037    -2.54   0.011    -.0796338   -.0102214
         10  |  -.0271394   .0177037    -1.53   0.125    -.0618456    .0075668
         11  |  -.0663346   .0177037    -3.75   0.000    -.1010409   -.0316284
         12  |  -.0198649   .0177037    -1.12   0.262    -.0545711    .0148413
         13  |  -.0131799   .0177037    -0.74   0.457    -.0478861    .0215264
         14  |  -.0034511   .0177037    -0.19   0.845    -.0381573    .0312551
         15  |   .0096168   .0177037     0.54   0.587    -.0250894     .044323
         16  |  -.0460741   .0177037    -2.60   0.009    -.0807804   -.0113679
         17  |  -.0215037   .0177037    -1.21   0.225    -.0562099    .0132025
         18  |  -.0848731   .0177037    -4.79   0.000    -.1195793   -.0501669
         19  |   .0322069   .0177037     1.82   0.069    -.0024993    .0669131
         20  |   .0061922   .0177037     0.35   0.727     -.028514    .0408984
         21  |  -.0214032   .0177037    -1.21   0.227    -.0561095     .013303
         22  |   .0072421   .0177037     0.41   0.683    -.0274641    .0419484
         23  |  -.0683914   .0177037    -3.86   0.000    -.1030976   -.0336852
         24  |   .0333578   .0177037     1.88   0.060    -.0013484     .068064
         25  |   .0711326   .0177037     4.02   0.000     .0364264    .1058388
         26  |  -.0387809   .0177037    -2.19   0.029    -.0734871   -.0040746
         27  |   .0169559   .0177037     0.96   0.338    -.0177503    .0516621
         28  |  -.0492857   .0177037    -2.78   0.005    -.0839919   -.0145795
         29  |  -.0339525   .0177037    -1.92   0.055    -.0686587    .0007537
         30  |   .0179631   .0177037     1.01   0.310    -.0167431    .0526693
         31  |   .0538777   .0177037     3.04   0.002     .0191715    .0885839
         32  |  -.0142134   .0177037    -0.80   0.422    -.0489196    .0204928
         33  |   .0474473   .0177037     2.68   0.007      .012741    .0821535
         34  |  -.0317294   .0177037    -1.79   0.073    -.0664357    .0029768
         35  |   .0413572   .0177037     2.34   0.020      .006651    .0760634
         36  |   .0270809   .0177037     1.53   0.126    -.0076253    .0617871
         37  |   -.049687   .0177037    -2.81   0.005    -.0843932   -.0149808
         38  |   .0359605   .0177037     2.03   0.042     .0012543    .0706667
         39  |  -.0297369   .0177037    -1.68   0.093    -.0644431    .0049694
         40  |  -.0190212   .0177037    -1.07   0.283    -.0537274     .015685
         41  |   .0059927   .0177037     0.34   0.735    -.0287135    .0406989
         42  |  -.0215471   .0177037    -1.22   0.224    -.0562533    .0131591
         43  |  -.0231805   .0177037    -1.31   0.190    -.0578867    .0115257
         44  |   .0198575   .0177037     1.12   0.262    -.0148487    .0545637
         45  |   .0162103   .0177037     0.92   0.360    -.0184959    .0509165
         46  |   .0425333   .0177037     2.40   0.016     .0078271    .0772395
         47  |  -.0457316   .0177037    -2.58   0.010    -.0804378   -.0110254
         48  |   .0263947   .0177037     1.49   0.136    -.0083115    .0611009
         49  |  -.0461492   .0177037    -2.61   0.009    -.0808554    -.011443
         50  |  -.0709933   .0177037    -4.01   0.000    -.1056995   -.0362871
         51  |   -.047524   .0177037    -2.68   0.007    -.0822302   -.0128178
         52  |  -.0449302   .0177037    -2.54   0.011    -.0796364   -.0102239
         53  |  -.0726629   .0177037    -4.10   0.000    -.1073691   -.0379566
         54  |  -.0039451   .0177037    -0.22   0.824    -.0386513    .0307611
         55  |  -.0115221   .0177037    -0.65   0.515    -.0462283    .0231841
         56  |  -.0000788   .0177037    -0.00   0.996     -.034785    .0346274
         57  |   .0165654   .0177037     0.94   0.349    -.0181408    .0512716
         58  |  -.0220309   .0177037    -1.24   0.213    -.0567371    .0126753
         59  |  -.0066356   .0177037    -0.37   0.708    -.0413418    .0280706
         60  |   .0316898   .0177037     1.79   0.074    -.0030165     .066396
         61  |   .0677658   .0177037     3.83   0.000     .0330596     .102472
         62  |   .0272186   .0177037     1.54   0.124    -.0074876    .0619248
         63  |  -.0477142   .0177037    -2.70   0.007    -.0824204    -.013008
         64  |   .0015401   .0177037     0.09   0.931    -.0331661    .0362463
         65  |   .0155501   .0177037     0.88   0.380    -.0191561    .0502563
         66  |   .0752376   .0177037     4.25   0.000     .0405314    .1099438
         67  |   .0434331   .0177037     2.45   0.014     .0087269    .0781393
         68  |  -.0281283   .0177037    -1.59   0.112    -.0628345     .006578
         69  |   .0204488   .0177037     1.16   0.248    -.0142574     .055155
         70  |   .0477585   .0177037     2.70   0.007     .0130522    .0824647
         71  |  -.0011984   .0177037    -0.07   0.946    -.0359046    .0335078
         72  |   .0412188   .0177037     2.33   0.020     .0065126     .075925
         73  |   .0328962   .0177037     1.86   0.063      -.00181    .0676024
         74  |   .0959444   .0177037     5.42   0.000     .0612382    .1306506
         75  |  -.0248425   .0177037    -1.40   0.161    -.0595487    .0098637
         76  |  -.0597242   .0177037    -3.37   0.001    -.0944304    -.025018
         77  |   .0155004   .0177037     0.88   0.381    -.0192058    .0502066
         78  |   .0023913   .0177037     0.14   0.893    -.0323149    .0370975
         79  |    .051463   .0177037     2.91   0.004     .0167568    .0861692
         80  |  -.0282713   .0177037    -1.60   0.110    -.0629775    .0064349
         81  |  -.0115589   .0177037    -0.65   0.514    -.0462651    .0231473
         82  |  -.0463194   .0177037    -2.62   0.009    -.0810256   -.0116132
         83  |   .0549381   .0177037     3.10   0.002     .0202319    .0896443
         84  |  -.0237981   .0177037    -1.34   0.179    -.0585043    .0109081
         85  |  -.0395869   .0177037    -2.24   0.025    -.0742931   -.0048807
         86  |   .0140537   .0177037     0.79   0.427    -.0206525    .0487599
         87  |  -.0456679   .0177037    -2.58   0.010    -.0803741   -.0109617
         88  |  -.0978886   .0177037    -5.53   0.000    -.1325948   -.0631824
         89  |   .1567992   .0177037     8.86   0.000      .122093    .1915054
         90  |  -.0246092   .0177037    -1.39   0.165    -.0593154     .010097
         91  |  -.0588708   .0177037    -3.33   0.001     -.093577   -.0241646
         92  |  -.0387872   .0177037    -2.19   0.028    -.0734934    -.004081
         93  |   .0641024   .0177037     3.62   0.000     .0293962    .0988086
         94  |  -.0308961   .0177037    -1.75   0.081    -.0656023    .0038101
         95  |  -.0396196   .0177037    -2.24   0.025    -.0743258   -.0049134
         96  |   -.055389   .0177037    -3.13   0.002    -.0900952   -.0206828
         97  |    .168835   .0177037     9.54   0.000     .1341288    .2035412
         98  |   -.031635   .0177037    -1.79   0.074    -.0663412    .0030712
         99  |   .0621631   .0177037     3.51   0.000     .0274569    .0968693
        100  |   .0044086   .0177037     0.25   0.803    -.0302976    .0391148
        101  |  -.0416618   .0177037    -2.35   0.019     -.076368   -.0069556
        102  |   -.001127   .0177037    -0.06   0.949    -.0358332    .0335792
        103  |    .060717   .0177037     3.43   0.001     .0260108    .0954232
        104  |  -.0782415   .0177037    -4.42   0.000    -.1129477   -.0435352
        105  |  -.0357128   .0177037    -2.02   0.044     -.070419   -.0010066
        106  |  -.0270939   .0177037    -1.53   0.126    -.0618001    .0076123
        107  |   .0401573   .0177037     2.27   0.023     .0054511    .0748635
        108  |  -.0653616   .0177037    -3.69   0.000    -.1000678   -.0306554
        109  |  -.0560756   .0177037    -3.17   0.002    -.0907818   -.0213694
        110  |   .0065055   .0177037     0.37   0.713    -.0282007    .0412117
        111  |  -.0301916   .0177037    -1.71   0.088    -.0648978    .0045146
        112  |   .0143614   .0177037     0.81   0.417    -.0203448    .0490677
        113  |  -.0112408   .0177037    -0.63   0.525     -.045947    .0234654
        114  |   .0594683   .0177037     3.36   0.001     .0247621    .0941745
        115  |  -.0520106   .0177037    -2.94   0.003    -.0867168   -.0173044
        116  |   .0191136   .0177037     1.08   0.280    -.0155926    .0538198
        117  |   .1078621   .0177037     6.09   0.000     .0731559    .1425683
        118  |  -.0413463   .0177037    -2.34   0.020    -.0760525   -.0066401
        119  |  -.0390276   .0177037    -2.20   0.028    -.0737338   -.0043214
        120  |   .0494182   .0177037     2.79   0.005      .014712    .0841244
        121  |  -.0457608   .0177037    -2.58   0.010     -.080467   -.0110546
        122  |  -.0580835   .0177037    -3.28   0.001    -.0927897   -.0233773
        123  |   .0869552   .0177037     4.91   0.000      .052249    .1216614
        124  |    .006985   .0177037     0.39   0.693    -.0277212    .0416912
        125  |  -.0312861   .0177037    -1.77   0.077    -.0659923    .0034201
        126  |  -.0369805   .0177037    -2.09   0.037    -.0716867   -.0022743
        127  |  -.0143831   .0177037    -0.81   0.417    -.0490894    .0203231
        128  |   .0574712   .0177037     3.25   0.001      .022765    .0921774
        129  |    .013773   .0177037     0.78   0.437    -.0209332    .0484792
        130  |  -.0983107   .0177037    -5.55   0.000    -.1330169   -.0636044
        131  |  -.0066625   .0177037    -0.38   0.707    -.0413687    .0280437
        132  |  -.0674566   .0177037    -3.81   0.000    -.1021628   -.0327504
        133  |   .0762481   .0177037     4.31   0.000     .0415419    .1109543
        134  |   .1330009   .0177037     7.51   0.000     .0982946    .1677071
        135  |   -.082001   .0177037    -4.63   0.000    -.1167072   -.0472948
        136  |  -.0205373   .0177037    -1.16   0.246    -.0552435    .0141689
        137  |  -.0525667   .0177037    -2.97   0.003    -.0872729   -.0178605
        138  |   .0158057   .0177037     0.89   0.372    -.0189005    .0505119
        139  |   .1230968   .0177037     6.95   0.000     .0883906     .157803
        140  |    .023623   .0177037     1.33   0.182    -.0110832    .0583292
        141  |   .0136152   .0177037     0.77   0.442     -.021091    .0483214
        142  |  -.0049101   .0177037    -0.28   0.782    -.0396163    .0297961
        143  |   .0181167   .0177037     1.02   0.306    -.0165895    .0528229
        144  |   .0112982   .0177037     0.64   0.523     -.023408    .0460044
        145  |  -.0045251   .0177037    -0.26   0.798    -.0392313    .0301811
        146  |  -.0214016   .0177037    -1.21   0.227    -.0561078    .0133046
        147  |  -.0467027   .0177037    -2.64   0.008    -.0814089   -.0119965
        148  |  -.0506048   .0177037    -2.86   0.004     -.085311   -.0158986
        149  |  -.0600311   .0177037    -3.39   0.001    -.0947373   -.0253249
        150  |    .069006   .0177037     3.90   0.000     .0342998    .1037122
        151  |   .0471642   .0177037     2.66   0.008      .012458    .0818705
        152  |   .0452041   .0177037     2.55   0.011     .0104979    .0799103
        153  |  -.0110455   .0177037    -0.62   0.533    -.0457517    .0236608
        154  |  -.0182215   .0177037    -1.03   0.303    -.0529277    .0164847
        155  |  -.0176781   .0177037    -1.00   0.318    -.0523843    .0170281
        156  |  -.0289575   .0177037    -1.64   0.102    -.0636637    .0057487
        157  |  -.0532392   .0177037    -3.01   0.003    -.0879454    -.018533
        158  |  -.0334624   .0177037    -1.89   0.059    -.0681686    .0012438
        159  |   -.017543   .0177037    -0.99   0.322    -.0522492    .0171632
        160  |   -.037459   .0177037    -2.12   0.034    -.0721652   -.0027528
        161  |  -.0231408   .0177037    -1.31   0.191    -.0578471    .0115654
        162  |  -.0831324   .0177037    -4.70   0.000    -.1178386   -.0484262
        163  |  -.0468346   .0177037    -2.65   0.008    -.0815408   -.0121284
        164  |   .2471651   .0177037    13.96   0.000     .2124589    .2818713
             |
       _cons |   .1722653   .0125184    13.76   0.000     .1477243    .1968063
------------------------------------------------------------------------------

. predict einv, residuals

. 
. * regress q on firm dummies alone and obtain the residual
. reg q i.firm

      Source |       SS           df       MS      Number of obs   =     5,740
-------------+----------------------------------   F(163, 5576)    =     35.69
       Model |   42404.191       163  260.148411   Prob > F        =    0.0000
    Residual |  40640.1674     5,576  7.28840879   R-squared       =    0.5106
-------------+----------------------------------   Adj R-squared   =    0.4963
       Total |  83044.3584     5,739  14.4701792   Root MSE        =    2.6997

------------------------------------------------------------------------------
           q |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        firm |
          2  |  -4.866352    .645353    -7.54   0.000    -6.131495   -3.601208
          3  |  -3.003586    .645353    -4.65   0.000    -4.268729   -1.738443
          4  |  -4.527385    .645353    -7.02   0.000    -5.792528   -3.262242
          5  |  -4.758758    .645353    -7.37   0.000    -6.023901   -3.493615
          6  |  -4.300253    .645353    -6.66   0.000    -5.565397    -3.03511
          7  |  -5.067738    .645353    -7.85   0.000    -6.332881   -3.802595
          8  |  -4.367086    .645353    -6.77   0.000    -5.632229   -3.101943
          9  |  -4.778749    .645353    -7.40   0.000    -6.043893   -3.513606
         10  |  -3.910269    .645353    -6.06   0.000    -5.175412   -2.645126
         11  |  -4.552061    .645353    -7.05   0.000    -5.817204   -3.286918
         12  |   -2.99148    .645353    -4.64   0.000    -4.256624   -1.726337
         13  |   6.827187    .645353    10.58   0.000     5.562044    8.092331
         14  |   -4.61121    .645353    -7.15   0.000    -5.876354   -3.346067
         15  |  -2.805525    .645353    -4.35   0.000    -4.070668   -1.540381
         16  |  -4.898768    .645353    -7.59   0.000    -6.163911   -3.633625
         17  |  -3.984481    .645353    -6.17   0.000    -5.249625   -2.719338
         18  |  -5.096064    .645353    -7.90   0.000    -6.361207    -3.83092
         19  |  -4.358045    .645353    -6.75   0.000    -5.623189   -3.092902
         20  |  -4.323588    .645353    -6.70   0.000    -5.588732   -3.058445
         21  |  -3.414516    .645353    -5.29   0.000     -4.67966   -2.149373
         22  |  -3.175872    .645353    -4.92   0.000    -4.441016   -1.910729
         23  |  -5.251062    .645353    -8.14   0.000    -6.516205   -3.985919
         24  |  -1.137682    .645353    -1.76   0.078    -2.402825    .1274617
         25  |  -3.759242    .645353    -5.83   0.000    -5.024385   -2.494099
         26  |  -4.054692    .645353    -6.28   0.000    -5.319835   -2.789549
         27  |  -4.216341    .645353    -6.53   0.000    -5.481485   -2.951198
         28  |   1.023417    .645353     1.59   0.113    -.2417258    2.288561
         29  |  -3.212386    .645353    -4.98   0.000     -4.47753   -1.947243
         30  |  -3.526282    .645353    -5.46   0.000    -4.791425   -2.261138
         31  |  -2.992644    .645353    -4.64   0.000    -4.257788   -1.727501
         32  |  -4.799077    .645353    -7.44   0.000     -6.06422   -3.533934
         33  |   -2.02086    .645353    -3.13   0.002    -3.286003   -.7557163
         34  |  -4.800237    .645353    -7.44   0.000    -6.065381   -3.535094
         35  |  -3.016051    .645353    -4.67   0.000    -4.281194   -1.750908
         36  |  -3.882698    .645353    -6.02   0.000    -5.147841   -2.617554
         37  |   -3.95331    .645353    -6.13   0.000    -5.218453   -2.688167
         38  |  -4.353644    .645353    -6.75   0.000    -5.618787   -3.088501
         39  |  -4.427102    .645353    -6.86   0.000    -5.692245   -3.161959
         40  |  -3.360462    .645353    -5.21   0.000    -4.625605   -2.095318
         41  |   2.368921    .645353     3.67   0.000     1.103778    3.634065
         42  |  -3.516076    .645353    -5.45   0.000    -4.781219   -2.250933
         43  |  -4.510337    .645353    -6.99   0.000     -5.77548   -3.245193
         44  |  -3.992002    .645353    -6.19   0.000    -5.257146   -2.726859
         45  |  -3.720063    .645353    -5.76   0.000    -4.985206    -2.45492
         46  |  -4.422873    .645353    -6.85   0.000    -5.688017    -3.15773
         47  |  -4.743883    .645353    -7.35   0.000    -6.009026    -3.47874
         48  |   2.809145    .645353     4.35   0.000     1.544001    4.074288
         49  |  -5.324561    .645353    -8.25   0.000    -6.589704   -4.059418
         50  |  -4.941651    .645353    -7.66   0.000    -6.206794   -3.676507
         51  |  -4.544886    .645353    -7.04   0.000     -5.81003   -3.279743
         52  |  -3.849973    .645353    -5.97   0.000    -5.115116    -2.58483
         53  |  -5.183904    .645353    -8.03   0.000    -6.449047   -3.918761
         54  |  -3.559118    .645353    -5.51   0.000    -4.824262   -2.293975
         55  |  -4.617728    .645353    -7.16   0.000    -5.882871   -3.352585
         56  |  -4.402726    .645353    -6.82   0.000    -5.667869   -3.137582
         57  |  -4.075778    .645353    -6.32   0.000    -5.340921   -2.810635
         58  |  -.7649613    .645353    -1.19   0.236    -2.030105     .500182
         59  |  -4.478312    .645353    -6.94   0.000    -5.743455   -3.213169
         60  |  -1.993179    .645353    -3.09   0.002    -3.258322   -.7280354
         61  |  -3.732652    .645353    -5.78   0.000    -4.997795   -2.467508
         62  |   1.251882    .645353     1.94   0.052    -.0132611    2.517025
         63  |  -4.664669    .645353    -7.23   0.000    -5.929812   -3.399526
         64  |   3.224053    .645353     5.00   0.000     1.958909    4.489196
         65  |  -3.775961    .645353    -5.85   0.000    -5.041104   -2.510818
         66  |   .0659443    .645353     0.10   0.919    -1.199199    1.331088
         67  |  -3.686471    .645353    -5.71   0.000    -4.951614   -2.421327
         68  |  -3.917178    .645353    -6.07   0.000    -5.182321   -2.652034
         69  |  -3.524795    .645353    -5.46   0.000    -4.789938   -2.259652
         70  |  -2.835203    .645353    -4.39   0.000    -4.100346    -1.57006
         71  |  -4.027183    .645353    -6.24   0.000    -5.292326   -2.762039
         72  |  -3.765691    .645353    -5.84   0.000    -5.030834   -2.500547
         73  |  -.0799685    .645353    -0.12   0.901    -1.345112    1.185175
         74  |  -3.145733    .645353    -4.87   0.000    -4.410876    -1.88059
         75  |  -3.431694    .645353    -5.32   0.000    -4.696837    -2.16655
         76  |  -5.224431    .645353    -8.10   0.000    -6.489575   -3.959288
         77  |  -2.735045    .645353    -4.24   0.000    -4.000188   -1.469901
         78  |  -1.744269    .645353    -2.70   0.007    -3.009412   -.4791253
         79  |   5.688083    .645353     8.81   0.000     4.422939    6.953226
         80  |  -4.443287    .645353    -6.89   0.000    -5.708431   -3.178144
         81  |   -4.14593    .645353    -6.42   0.000    -5.411073   -2.880786
         82  |  -4.785723    .645353    -7.42   0.000    -6.050866   -3.520579
         83  |  -3.828204    .645353    -5.93   0.000    -5.093348   -2.563061
         84  |  -4.700998    .645353    -7.28   0.000    -5.966141   -3.435854
         85  |  -4.411584    .645353    -6.84   0.000    -5.676728   -3.146441
         86  |  -2.380325    .645353    -3.69   0.000    -3.645468   -1.115181
         87  |  -2.501125    .645353    -3.88   0.000    -3.766268   -1.235982
         88  |  -5.227596    .645353    -8.10   0.000     -6.49274   -3.962453
         89  |   -.900681    .645353    -1.40   0.163    -2.165824    .3644622
         90  |  -4.520257    .645353    -7.00   0.000    -5.785401   -3.255114
         91  |  -3.858013    .645353    -5.98   0.000    -5.123156   -2.592869
         92  |  -2.856521    .645353    -4.43   0.000    -4.121664   -1.591377
         93  |   .3832855    .645353     0.59   0.553    -.8818578    1.648429
         94  |  -4.256308    .645353    -6.60   0.000    -5.521452   -2.991165
         95  |  -4.171619    .645353    -6.46   0.000    -5.436762   -2.906476
         96  |  -5.261856    .645353    -8.15   0.000    -6.526999   -3.996713
         97  |   4.941089    .645353     7.66   0.000     3.675946    6.206233
         98  |  -3.930475    .645353    -6.09   0.000    -5.195618   -2.665331
         99  |    2.91987    .645353     4.52   0.000     1.654727    4.185013
        100  |  -3.770992    .645353    -5.84   0.000    -5.036135   -2.505848
        101  |   -4.13243    .645353    -6.40   0.000    -5.397574   -2.867287
        102  |   .4942529    .645353     0.77   0.444    -.7708903    1.759396
        103  |  -2.791056    .645353    -4.32   0.000    -4.056199   -1.525912
        104  |  -4.941557    .645353    -7.66   0.000      -6.2067   -3.676414
        105  |  -3.646751    .645353    -5.65   0.000    -4.911895   -2.381608
        106  |  -5.073405    .645353    -7.86   0.000    -6.338548   -3.808262
        107  |  -3.679438    .645353    -5.70   0.000    -4.944582   -2.414295
        108  |  -4.607226    .645353    -7.14   0.000    -5.872369   -3.342082
        109  |  -4.858157    .645353    -7.53   0.000      -6.1233   -3.593014
        110  |  -4.706094    .645353    -7.29   0.000    -5.971237   -3.440951
        111  |  -4.628273    .645353    -7.17   0.000    -5.893416    -3.36313
        112  |    6.76293    .645353    10.48   0.000     5.497787    8.028073
        113  |  -4.744689    .645353    -7.35   0.000    -6.009832   -3.479546
        114  |   6.468334    .645353    10.02   0.000     5.203191    7.733478
        115  |  -4.840617    .645353    -7.50   0.000     -6.10576   -3.575474
        116  |  -3.198145    .645353    -4.96   0.000    -4.463288   -1.933002
        117  |   -1.53468    .645353    -2.38   0.017    -2.799824    -.269537
        118  |  -4.583168    .645353    -7.10   0.000    -5.848311   -3.318024
        119  |  -2.328837    .645353    -3.61   0.000     -3.59398   -1.063694
        120  |   3.537956    .645353     5.48   0.000     2.272813    4.803099
        121  |  -4.903066    .645353    -7.60   0.000    -6.168209   -3.637923
        122  |  -4.399257    .645353    -6.82   0.000    -5.664401   -3.134114
        123  |  -3.730955    .645353    -5.78   0.000    -4.996098   -2.465812
        124  |  -2.883669    .645353    -4.47   0.000    -4.148812   -1.618525
        125  |   -3.91029    .645353    -6.06   0.000    -5.175434   -2.645147
        126  |  -4.147117    .645353    -6.43   0.000     -5.41226   -2.881973
        127  |  -3.864778    .645353    -5.99   0.000    -5.129921   -2.599635
        128  |  -1.473463    .645353    -2.28   0.022    -2.738606   -.2083193
        129  |  -.1202265    .645353    -0.19   0.852     -1.38537    1.144917
        130  |  -4.537601    .645353    -7.03   0.000    -5.802744   -3.272458
        131  |  -4.070799    .645353    -6.31   0.000    -5.335942   -2.805656
        132  |  -4.347549    .645353    -6.74   0.000    -5.612693   -3.082406
        133  |  -2.758069    .645353    -4.27   0.000    -4.023212   -1.492926
        134  |  -2.942074    .645353    -4.56   0.000    -4.207217    -1.67693
        135  |  -4.827747    .645353    -7.48   0.000     -6.09289   -3.562603
        136  |  -4.176109    .645353    -6.47   0.000    -5.441253   -2.910966
        137  |  -4.257219    .645353    -6.60   0.000    -5.522362   -2.992075
        138  |  -4.456349    .645353    -6.91   0.000    -5.721493   -3.191206
        139  |  -3.442303    .645353    -5.33   0.000    -4.707446    -2.17716
        140  |  -1.556216    .645353    -2.41   0.016    -2.821359   -.2910723
        141  |  -4.472818    .645353    -6.93   0.000    -5.737962   -3.207675
        142  |  -2.412541    .645353    -3.74   0.000    -3.677684   -1.147398
        143  |   9.765928    .645353    15.13   0.000     8.500785    11.03107
        144  |   .3742963    .645353     0.58   0.562     -.890847     1.63944
        145  |  -4.243346    .645353    -6.58   0.000    -5.508489   -2.978203
        146  |  -4.353792    .645353    -6.75   0.000    -5.618935   -3.088649
        147  |   1.446372    .645353     2.24   0.025     .1812283    2.711515
        148  |  -5.129339    .645353    -7.95   0.000    -6.394483   -3.864196
        149  |  -3.880535    .645353    -6.01   0.000    -5.145679   -2.615392
        150  |  -3.562787    .645353    -5.52   0.000    -4.827931   -2.297644
        151  |  -3.412235    .645353    -5.29   0.000    -4.677378   -2.147092
        152  |  -.8175055    .645353    -1.27   0.205    -2.082649    .4476378
        153  |  -3.418071    .645353    -5.30   0.000    -4.683214   -2.152928
        154  |  -3.933964    .645353    -6.10   0.000    -5.199108   -2.668821
        155  |   -3.53725    .645353    -5.48   0.000    -4.802393   -2.272106
        156  |  -3.005625    .645353    -4.66   0.000    -4.270768   -1.740481
        157  |  -3.112807    .645353    -4.82   0.000     -4.37795   -1.847663
        158  |  -4.602697    .645353    -7.13   0.000    -5.867841   -3.337554
        159  |  -3.806547    .645353    -5.90   0.000    -5.071691   -2.541404
        160  |  -4.632064    .645353    -7.18   0.000    -5.897208   -3.366921
        161  |  -2.440271    .645353    -3.78   0.000    -3.705414   -1.175128
        162  |  -5.618929    .645353    -8.71   0.000    -6.884072   -4.353786
        163  |  -2.098864    .645353    -3.25   0.001    -3.364007   -.8337206
        164  |     5.9711    .645353     9.25   0.000     4.705957    7.236243
             |
       _cons |   4.532296   .4563335     9.93   0.000     3.637705    5.426888
------------------------------------------------------------------------------

. predict eq, residuals

. 
. * regress einv on eq, the partitioned regression, partialing out result 
. reg einv eq

      Source |       SS           df       MS      Number of obs   =     5,740
-------------+----------------------------------   F(1, 5738)      =    430.75
       Model |  2.13557517         1  2.13557517   Prob > F        =    0.0000
    Residual |  28.4481498     5,738  .004957851   R-squared       =    0.0698
-------------+----------------------------------   Adj R-squared   =    0.0697
       Total |   30.583725     5,739  .005329104   Root MSE        =    .07041

------------------------------------------------------------------------------
        einv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          eq |    .007249   .0003493    20.75   0.000     .0065643    .0079337
       _cons |   1.59e-12   .0009294     0.00   1.000    -.0018219    .0018219
------------------------------------------------------------------------------

. 
. * Follow up questions addressed in the LaTex write-up
. 
. *pause Part C completed
. 
. 
. *** Part D
. * Purely analytical and addressed in the LaTex write-up
. * Not asked to compute anything in Stata
. 
. 
. *** Part E
. * Regress inv on eq 
. reg inv eq

      Source |       SS           df       MS      Number of obs   =     5,740
-------------+----------------------------------   F(1, 5738)      =    276.30
       Model |  2.13557518         1  2.13557518   Prob > F        =    0.0000
    Residual |   44.349736     5,738  .007729128   R-squared       =    0.0459
-------------+----------------------------------   Adj R-squared   =    0.0458
       Total |  46.4853111     5,739  .008099897   Root MSE        =    .08792

------------------------------------------------------------------------------
         inv |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          eq |    .007249   .0004361    16.62   0.000     .0063941    .0081039
       _cons |   .1686158   .0011604   145.31   0.000      .166341    .1708906
------------------------------------------------------------------------------

. 
. * Follow up questions addressed in the LaTex write-up
. 
. *pause Part E completed
. 
end of do-file

. 
. do $programdir/stata_32.do

. /*
> Grant Aarons
> gaarons@london.edu
> Econometrics 1, London Business School
> Assignment 3
> */
. * Load the data
. import excel "$datadir/ps3.xls", sheet("Sheet1") firstrow clear

. *pause Dataset has been loaded
. 
. * Need to identify panelists/firms
. gen individual = _n

. 
. * Reshape the data from wide to long
. reshape long w ed a, i(individual) j(year)
(note: j = 0 1 2)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                     1500   ->    4500
Number of variables                  10   ->       5
j variable (3 values)                     ->   year
xij variables:
                               w0 w1 w2   ->   w
                            ed0 ed1 ed2   ->   ed
                               a0 a1 a2   ->   a
-----------------------------------------------------------------------------

. replace w = log(w)
variable w was long now double
(4,500 real changes made)

. gen xp = a-ed-6

. gen xp_p2 = xp^2

. 
. * Create necessary variables
. by individual: egen luwe=mean(w)

. by individual: egen educ=mean(ed)

. by individual: egen exp=mean(xp)

. by individual: egen exp_p2=mean(xp_p2)

. 
. *pause Check the means calculated above by individual
. 
. *** Part A
. * For the 1990 portion of the data, regress log(wage) on constant, educ, exp, exp2
. * NOT SURE THAT THE PSET is written correctly, want the means of the individual over each variab
> le...?
. 
. * should we regress the average over all individuals or just 1990 
. * (average by individual used later) NOT THIS: reg luwe educ exp exp_p2
. reg w ed xp xp_p2 if year==0

      Source |       SS           df       MS      Number of obs   =     1,500
-------------+----------------------------------   F(3, 1496)      =     46.28
       Model |  91.6141861         3   30.538062   Prob > F        =    0.0000
    Residual |  987.209592     1,496   .65989946   R-squared       =    0.0849
-------------+----------------------------------   Adj R-squared   =    0.0831
       Total |  1078.82378     1,499  .719695649   Root MSE        =    .81234

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .1440517   .0131358    10.97   0.000     .1182852    .1698182
          xp |    .026499   .0284373     0.93   0.352    -.0292823    .0822802
       xp_p2 |   .0009687   .0013386     0.72   0.469    -.0016571    .0035945
       _cons |   7.384689   .2795876    26.41   0.000     6.836263    7.933114
------------------------------------------------------------------------------

. 
. * Pooled Regression (1990-1992)
. reg w ed xp xp_p2

      Source |       SS           df       MS      Number of obs   =     4,500
-------------+----------------------------------   F(3, 4496)      =    164.80
       Model |  318.441207         3  106.147069   Prob > F        =    0.0000
    Residual |  2895.83354     4,496   .64409109   R-squared       =    0.0991
-------------+----------------------------------   Adj R-squared   =    0.0985
       Total |  3214.27475     4,499  .714442043   Root MSE        =    .80255

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .1479199   .0072281    20.46   0.000     .1337493    .1620905
          xp |   .0273553   .0165968     1.65   0.099    -.0051826    .0598931
       xp_p2 |   .0005749   .0007205     0.80   0.425    -.0008377    .0019874
       _cons |   7.385116   .1622288    45.52   0.000     7.067067    7.703164
------------------------------------------------------------------------------

. 
. *pause Part A completed
. 
. 
. *** Part B
. * Discussed in the LaTex write-up
. * Not asked to compute anything in Stata, but helpful to do so
. 
. *Combined for all IV 
. rvfplot

. graph export "..\output\fittedResid_hettest.pdf", replace
(file ..\output\fittedResid_hettest.pdf written in PDF format)

. estat hettest

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: fitted values of w

         chi2(1)      =   114.87
         Prob > chi2  =   0.0000

. 
. *For individual IV 
. rvpplot ed

. graph export "..\output\edResid_hettest.pdf", replace
(file ..\output\edResid_hettest.pdf written in PDF format)

. rvpplot xp

. graph export "..\output\xpResid_hettest.pdf", replace
(file ..\output\xpResid_hettest.pdf written in PDF format)

. rvpplot xp_p2

. graph export "..\output\xp_p2Resid_hettest.pdf", replace
(file ..\output\xp_p2Resid_hettest.pdf written in PDF format)

. 
. estat hettest ed

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: ed

         chi2(1)      =    76.42
         Prob > chi2  =   0.0000

. estat hettest xp

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: xp

         chi2(1)      =     1.19
         Prob > chi2  =   0.2760

. estat hettest xp_p2

Breusch-Pagan / Cook-Weisberg test for heteroskedasticity 
         Ho: Constant variance
         Variables: xp_p2

         chi2(1)      =     0.00
         Prob > chi2  =   0.9587

. 
. *** Part C
. * Purely analytical and addressed in the LaTex write-up
. * Not asked to compute anything in Stata
. * The problem set should have asked us to compute the FE estimated coefficients
. xi year

. reg w ed xp xp_p2 i.year

      Source |       SS           df       MS      Number of obs   =     4,500
-------------+----------------------------------   F(5, 4494)      =     99.14
       Model |  319.315949         5  63.8631898   Prob > F        =    0.0000
    Residual |   2894.9588     4,494  .644183089   R-squared       =    0.0993
-------------+----------------------------------   Adj R-squared   =    0.0983
       Total |  3214.27475     4,499  .714442043   Root MSE        =    .80261

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .1464139   .0074734    19.59   0.000     .1317624    .1610655
          xp |   .0253395   .0167407     1.51   0.130    -.0074805    .0581595
       xp_p2 |   .0006004   .0007209     0.83   0.405    -.0008129    .0020136
             |
        year |
          1  |   .0340731   .0298066     1.14   0.253    -.0243624    .0925086
          2  |   .0247063   .0312118     0.79   0.429    -.0364843    .0858968
             |
       _cons |   7.403881   .1652676    44.80   0.000     7.079875    7.727887
------------------------------------------------------------------------------

. 
. * To show the effect of different years on the coefficient estimates
. reg w ed xp xp_p2 if year==0

      Source |       SS           df       MS      Number of obs   =     1,500
-------------+----------------------------------   F(3, 1496)      =     46.28
       Model |  91.6141861         3   30.538062   Prob > F        =    0.0000
    Residual |  987.209592     1,496   .65989946   R-squared       =    0.0849
-------------+----------------------------------   Adj R-squared   =    0.0831
       Total |  1078.82378     1,499  .719695649   Root MSE        =    .81234

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .1440517   .0131358    10.97   0.000     .1182852    .1698182
          xp |    .026499   .0284373     0.93   0.352    -.0292823    .0822802
       xp_p2 |   .0009687   .0013386     0.72   0.469    -.0016571    .0035945
       _cons |   7.384689   .2795876    26.41   0.000     6.836263    7.933114
------------------------------------------------------------------------------

. reg w ed xp xp_p2 if year==1

      Source |       SS           df       MS      Number of obs   =     1,500
-------------+----------------------------------   F(3, 1496)      =     54.27
       Model |  104.638302         3  34.8794341   Prob > F        =    0.0000
    Residual |  961.470297     1,496  .642694049   R-squared       =    0.0981
-------------+----------------------------------   Adj R-squared   =    0.0963
       Total |   1066.1086     1,499  .711213208   Root MSE        =    .80168

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .1440497   .0129141    11.15   0.000     .1187179    .1693814
          xp |   .0152927   .0300446     0.51   0.611    -.0436413    .0742267
       xp_p2 |   .0008968   .0012998     0.69   0.490    -.0016529    .0034464
       _cons |   7.539949   .2956219    25.51   0.000     6.960071    8.119826
------------------------------------------------------------------------------

. reg w ed xp xp_p2 if year==2

      Source |       SS           df       MS      Number of obs   =     1,500
-------------+----------------------------------   F(3, 1496)      =     61.41
       Model |   116.20869         3  38.7362301   Prob > F        =    0.0000
    Residual |  943.702983     1,496  .630817502   R-squared       =    0.1096
-------------+----------------------------------   Adj R-squared   =    0.1079
       Total |  1059.91167     1,499  .707079168   Root MSE        =    .79424

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .1501405    .012801    11.73   0.000     .1250307    .1752503
          xp |   .0057006   .0322058     0.18   0.860    -.0574728    .0688741
       xp_p2 |   .0012123   .0012884     0.94   0.347    -.0013151    .0037397
       _cons |   7.519055   .3162754    23.77   0.000     6.898665    8.139446
------------------------------------------------------------------------------

. 
. *** Part D
. * Only MATLAB
. 
. *** Part E
. * Estimate the within estimator \tilde{\beta}_W for the wage equation
. 
. preserve

. * Need demeaned variables
. replace w = w - luwe
(4,500 real changes made)

. replace ed = ed - educ
variable ed was byte now float
(4,500 real changes made)

. replace xp = xp - exp
(4,500 real changes made)

. replace xp_p2 = xp_p2 - exp_p2
(4,500 real changes made)

. * Need to do this to get the same coefficient names for Hausman test
. 
. * Pooled Regression (1990-1992) but after demeaned/Within/FixedEffects
. *reg w_dm ed_dm xp_dm xp_p2_dm
. reg w ed xp xp_p2

      Source |       SS           df       MS      Number of obs   =     4,500
-------------+----------------------------------   F(3, 4496)      =     23.26
       Model |  10.5005623         3  3.50018743   Prob > F        =    0.0000
    Residual |    676.6235     4,496  .150494551   R-squared       =    0.0153
-------------+----------------------------------   Adj R-squared   =    0.0146
       Total |  687.124063     4,499  .152728176   Root MSE        =    .38794

------------------------------------------------------------------------------
           w |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
          ed |   .0637628   .0264373     2.41   0.016     .0119326    .1155929
          xp |   .1301495   .0250195     5.20   0.000      .081099    .1791999
       xp_p2 |  -.0035098   .0011127    -3.15   0.002    -.0056913   -.0013284
       _cons |  -1.05e-08    .005783    -0.00   1.000    -.0113376    .0113375
------------------------------------------------------------------------------

. estimates store fixedEffects

. restore

. * Firm fixed effect
. * FOR within each individual demean the average over time, firm fixed effect
. 
. * Follow up questions addressed in the LaTex write-up
. 
. *pause Part E completed
. 
. *** Part F
. * Only MATLAB
. 
. *** Part G
. * Only Stata - WE CANNOT DO THIS PROBLEM WITH THE STATA IC license that we are 
. * given.  Max matsize=800 on IC and we need 1500. 
. 
. * Check if the results match with Stata by using the command xtgls on the 
. * variable from the original wage equation.
. 
. /* xtset individual year
> set matsize 2000
> xtgls w ed xp xp_p2
> estimates store gls
> */
. 
. * Follow up questions addressed in the LaTex write-up
. 
. *pause Part G completed
. 
. 
. *** Part H
. * Are the FGLS (MATLAB should match) results different than the FE ones? Perform a Hausman test.
>  
. 
. /* hausman fixedEffects gls
> */
. 
. * Follow up questions addressed in the LaTex write-up
. 
. *pause Part H completed
. 
. 
end of do-file

. 
. log close _all
      name:  Grant Aarons Assignment 3
       log:  C:\Users\gaarons\Git\Notes\Stata\2016F\Metrics\logs\stata_3.log
  log type:  text
 closed on:  11 Jan 2017, 20:52:11
--------------------------------------------------------------------------------------------------
